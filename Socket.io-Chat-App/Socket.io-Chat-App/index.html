<!doctype html>
<html>
    <head>
        <title>Socket.IO sample chat</title>
        <script src="scripts/socket.io-1.4.5.js"></script>
        <script src="scripts/jquery-2.2.3.js"></script>
        <link rel="stylesheet" href="css/main.css"/>
    </head>
    <body>
        <br/>
        <h4>Set your username to start chatting 
            <input type="text" placeholder="type in your username" id="username"/>
        </h4>

        <ul id="messages">
            
        </ul>
        <form action="">
            <input id="msg" autocomplete="off" placeholder="type in your message and press enter to send"/>
            <button>Send</button>
        </form>
        
        <label id="userTyping"></label>
        
        <!--User's  Scripts -->

        <script type="text/javascript">
            var socket = io();
            $('#username').focus();
            $('form').submit(function () {
                if ($('#username').val() === '') {
                    alert('Username is required to chat..');
                    $('#username').focus();
                    return false;
                }
                var req = {
                    username: $('#username').val(),
                    msg: $('#msg').val()
                };
                socket.emit('chat message', req);
                $('#msg').val('');
                //
                //Needed if you user broadcast at server end to append self messages
                //$('#messages').append($('<li class="keep-left">').html('<b>' + req.username + ': </b>' + req.msg));
                return false;
            });
            //
            $('#msg').on('keypress', function () {
                if ($(this).val().length % 3 == 0) {
                    socket.emit('typing', $('#username').val());
                }
            });
            //
            socket.on('chat message', function (msg) {
                $('#messages').append($('<li class="' + (msg.username === $('#username').val() ? 'my-msg' : 'fnds-msg') + '">').html('<b>' + msg.username + ': </b>' + msg.msg + '<span></span>'));
            });
            //
            socket.on('typing', function (msg) {
                $('#userTyping').html(msg + " is typing...").fadeIn().fadeOut();
            });
            //
            socket.on('broadcast', function(msg) {
                $('#messages').append($('<li>').text(msg));
            });
        </script>
        
    </body>
</html>